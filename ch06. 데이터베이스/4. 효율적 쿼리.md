# 효율적 쿼리
## 서브 쿼리와 조인
- 서브 쿼리: 다른 SQL문에 포함된 SQL문 / 주로 SELECT, INSERT, UPDATE, DELETE 문에 사용
- 조인: 두 개 이상의 테이블을 결합하여, 하나의 결과 집합으로 반환하는 SQL 연산
### 여러 테이블에 질의하기
- 기본 문법
```SQL
SELECT 테이블_이름1.필드_이름1, 테이블_이름2.필드_이름2, ...
    FROM 테이블_이름1, 테이블_이름2, ...
    WHERE 조건;
```
- 예시
```SQL
SELECT users.username, users.email, posts.title
    FROM users, posts
    WHERE users.user_id = posts.user_id;
```
### 서브 쿼리
- 대표적인 서브쿼리 유형
  - SELECT문 안에 SELECT문이 포함된 서브 쿼리
  - DELETE문 안에 SELECT문이 포함된 서브 쿼리

- 예시
  - SELECT문 안에 SELECT문이 포함된 서브 쿼리
    ```SQL
    // 'SQL'이라는 단어가 제목에 포함된 게시물을 작성한 사용자의 username과 email을 조회
    SELECT username, email
        FROM users
        WHERE user_id IN (SELECT user_id FROM posts WHERE title LIKE '%SQL%');
    ```
  - DELETE문 안에 SELECT문이 포함된 서브 쿼리
    ```SQL
    // email이 'kim@example.com'인 사용자가 작성한 모든 게시물을 삭제
    DELETE FROM posts
    WHERE user_id = (
        SELECT user_id
        FROM users
        WHERE email = 'kim@example.com'
    );
    ```
### 조인
- 개념
    - Inner Join: 두 테이블 간의 조인 조건을 만족하는 레코드만 반환하는 조인 방식
    ![](https://csnote.net/assets/img/db/inner_join.png)
    - Outer Join: 조인 조건을 만족하지 않는 레코드도 포함하여 반환하는 조인 방식
      - Left Join: 왼쪽 테이블의 모든 레코드를 포함하고, 조인 조건을 만족하지 않는 오른쪽 테이블의 레코드는 NULL로 반환
      ![](https://csnote.net/assets/img/db/left_join.png)
      - Right Join: 오른쪽 테이블의 모든 레코드를 포함하고, 조인 조건을 만족하지 않는 왼쪽 테이블의 레코드는 NULL로 반환
      ![](https://csnote.net/assets/img/db/right_join.png)
      - Full Join: 두 테이블의 모든 레코드를 포함하고, 조인 조건을 만족하지 않는 레코드는 NULL로 반환
      ![](https://csnote.net/assets/img/db/full_join.png)
- 기본 문법
```SQL
// Inner Join / Left Outer Join / Right Outer Join
SELECT 테이블_이름1.필드_이름1, 테이블_이름2.필드_이름2, ...
    FROM 테이블_이름1
    [INNER | LEFT OUTER | RIGHT OUTER] JOIN 테이블_이름2
    ON 테이블_이름1.필드_이름 = 테이블_이름2.필드_이름;
    
// Full Outer Join
SELECT 필드
FROM 테이블1
    LEFT JOIN 테이블2 ON 테이블1.필드 = 테이블2.필드;
    UNION
SELECT 필드
FROM 테이블1
    RIGHT JOIN 테이블2 ON 테이블1.필드 = 테이블2.필드;
```
- 예시
  - Inner Join
    ```SQL
    SELECT customers.name, customers.age, customers.email, orders.id, orders.product_id,
    orders.quantity, orders.amount
    FROM customers
        INNER JOIN orders ON customers.id = orders.customer_id;
    ```
  - Left Outer Join
    ```SQL
    SELECT customers.name, orders.id AS order_id, orders.product_id, orders.quantity,
    orders.amount
    FROM customers
        LEFT OUTER JOIN orders ON customers.id = orders.customer_id;
    ```
  - Right Outer Join
    ```SQL
    SELECT customers.name, orders.id AS order_id, orders.product_id, orders.quantity,
    orders.amount
    FROM customers
        RIGHT OUTER JOIN orders ON customers.id = orders.customer_id;
    ```
  - Full Outer Join
    ```SQL
    SELECT customers.name, orders.id AS order_id, orders.product_id, orders.quantity,
    orders.amount
    FROM customers
        LEFT OUTER JOIN orders ON customers.id = orders.customer_id
        UNION
    SELECT customers.name, orders.id AS order_id, orders.product_id, orders.quantity,
    orders.amount
    FROM customers
        RIGHT OUTER JOIN orders ON customers.id = orders.customer_id;
    ```
## 뷰
- 개념: 뷰(View)는 하나 이상의 테이블에서 유도된 가상 테이블로, 실제 데이터를 저장하지 않고 쿼리 결과를 저장
- 기본 문법
    ```SQL
    // 뷰 생성
    CREATE VIEW 뷰_이름 AS
        SELECT 필드_이름1, 필드_이름2, ...
        FROM 테이블_이름
        WHERE 조건;
    
    // 뷰 삭제
    DROP VIEW 뷰_이름;
    ```
- 예시
    ```SQL
    // 뷰 생성
    CREATE VIEW myview AS
        SELECT users.username, users.email, posts.title
        FROM users, posts
        WHERE users.user_id = posts.user_id;
    
    // 뷰 조회
    SELECT username, email, title
    FROM myview
    WHERE username = 'kim';
    ```
## 인덱스
- 개념
  - 인덱스: 데이터베이스 테이블의 검색 속도를 향상시키기 위해 사용되는 데이터 구조
  - 클러스터형 인덱스: 테이블의 데이터가 인덱스의 순서에 따라 물리적으로 정렬되는 인덱스
  - 세컨더리 인덱스: 클러스터형 인덱스와 별도로 생성되는 인덱스, 물리적으로 정렬되지 않는 인덱스
  - 어떨 때 사용할까?
    - 검색이 자주 발생하는 필드에 인덱스를 생성하면 조회 성능이 향상됨
    - 인덱스는 추가적인 저장 공간을 필요로 하며, 데이터 삽입, 갱신, 삭제 시 인덱스도 함께 갱신되어야 하므로 성능 저하가 발생할 수 있음
    
- 기본 문법
```SQL
// 인덱스 생성
CREATE INDEX 인덱스_이름
    ON 테이블_이름 (필드_이름1 [ASC | DESC], 필드_이름2 [ASC | DESC], ...);

// 인덱스 조회
SHOW INDEX FROM 테이블_이름;

// 인덱스 삭제
DROP INDEX 인덱스_이름 ON 테이블_이름;
```