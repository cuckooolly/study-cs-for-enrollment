# 물리 주소와 논리 주소
- 물리 주소: 하드웨어 상의 실제 메모리 주소
- 논리 주소: 프로세스마다 부여되는 가상의 메모리 주소
- 메모리 관리 장치: 물리주소와 논리주소를 변환하는 하드웨어

# 스와핑과 연속 메모리 할당
## 스와핑
- 메모리가 부족할 때, 프로세스를 일시적으로 보조 기억 장치로 옮기는 기법
![](https://csnote.net/assets/img/os/swapping.png)
## 연속 메모리 할당과 외부 단편화
- 프로세스에 연속적인 메모리 공간을 할당하는 방식
- 외부 단편화
  - 연속적으로 할당되는 메모리에서 생기는 현상
  - 할당과 해제를 반복하면서 생긴 빈 공간으로 인해, 더 큰 프로세스를 할당할 수 없는 문제
- ![](https://csnote.net/assets/img/os/external_fragmentation.png)
# 페이징을 통한 가상 메모리 관리
- 가상 메모리
  - 실행하고자 하는 프로그램을 일부만 메모리에 적재
  - 실제 물리 메모리 크기보다 더 큰 프로세스를 실행할 수 있게 하는 기술
- ![](https://csnote.net/assets/img/os/virtual_memory.png)
## 페이징
- 페이징
  - 프로세스의 논리 주소 공간을 페이지라는 일정한 단위로 자르고
  - 물리 메모리도 프레임이라는 동일한 크기의 단위로 자른 후
  - 페이지를 프레임에 매핑하여 적재하는 기법
- 세그멘테이션
  - 프로세스의 논리 주소 공간을 세그먼트라는 일정한 단위로 자르고
  - 물리 메모리도 동일한 크기의 단위로 자른 후
  - 세그먼트를 프레임에 매핑하여 적재하는 기법
- ![](https://mblogthumb-phinf.pstatic.net/MjAyMDAxMjhfMTUx/MDAxNTgwMTUyMTgzMDE1.cKL8rh0owjYNP4lQK-B5xmmmrbetfmyxIwng7yjNu0Ig.CNBKxWkdiYyszwaTG06eSWWquJFrB6l-m0-HzofbUXkg.PNG.dilector/01.png?type=w800)
- ![](https://postfiles.pstatic.net/MjAyMDAxMjhfMTAz/MDAxNTgwMTUyMTk0NDQw.LaehHqAHkNlfBrNgOEhPF_hx72ELXkjAZ2CXvKYLFL8g.gQ6vPlqBc4jrUAliyPjo_eVsYrP0k5yfIrume0Ggdpsg.PNG.dilector/02.png?type=w773)
- 페이지 아웃: 페이지 단위로 보조 기억 장치로 옮기는 것
- 페이지 인: 보조 기억 장치에서 페이지 단위로 메모리로 옮기는 것
## 페이지 테이블
- 페이지 테이블: 현재 어떤 페이지가 어떤 프레임에 할당되었는지 알기 위해 페이지 번호와 프레임 번호를 짝지어 주는 표 형태의 정보
- ![](https://csnote.net/assets/img/os/page_table.png)
### 테이블 엔트리
- 테이블 엔트리: 페이지 테이블의 각 행
  - 유효 비트: 페이지에 접근이 가능한지 알려주는 비트
  - 페이지 폴트: CPU가 메모리에 적재되지 않은 페이지에 접근할 때 발생하는 에러
    1. 기존 작업 내역을 백업
    2. 페이지 폴트 처리 루틴을 실행, 원하는 페이지를 메모리로 가져와 유효비트를 1로 변경
    3. 메모리에 적재된 페이지를 실행
  - 보호비트: Read, Write, Execute 권한을 나타내는 비트
  - 참조비트: CPU가 해당 페이지에 접근한 적이 있는지를 여부를 나타내는 비트
  - 수정비트: 해당 페이지에 데이터를 쓴 적이 있는 지를 나타내는 비트
- 내부 단편화: 마지막 페이지에 모두 채우지 못하고 남는 공간이 생기는 현상
![](https://csnote.net/assets/img/os/internal_fragmentation.png)
- 페이지 테이블 베이스 레지스터 (PTBR)
  - 각 프로세스별 페이지 테이블의 시작 주소를 가리키는 레지스터
  - 각 프로세스가 가지는 정보이므로, 문맥 교환 시 함께 저장되고 복원됨
### 페이지 테이블의 문제점과 해결책
- 모든 프로세스의 페이지 테이블을 두는 것은, 1. 메모리 접근 횟수가 많아지고, 2. 메모리 용량을 많이 차지 하므로, 비효율적.
- 이를 해결하기 위한 방법
  1. TLB(Translation Lookaside Buffer): 페이지 테이블의 캐시 메모리 역할을 수행하기 위해, 페이지 테이블의 일부를 저장하는 메모리
     - TLB 히트: TLB에서 원하는 페이지를 찾은 경우
     - TLB 미스: TLB에서 원하는 페이지를 찾지 못한 경우
     - ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2FNdk88%2FbtsIsZSOXi5%2FAAAAAAAAAAAAAAAAAAAAAD4AkOPIL1VOUh7ffYFXvJ7GZr4SdS56m1Um7ctHiZ6O%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1759244399%26allow_ip%3D%26allow_referer%3D%26signature%3DKiwJIeY4OaJYi1GbmHK%252B%252FaPFoRM%253D)
  2. 계층적 페이징(다단계 페이지 테이블): 여러 단계의 페이지를 두어, 전체 테이블을 메모리에 적재할 필요가 없어지게 됨
  ![](https://velog.velcdn.com/images%2Fholicme7%2Fpost%2F987d117f-160e-47e5-a999-7cfd91f7c390%2F2%EB%8B%A8%EA%B3%84%ED%8E%98%ED%85%8C.PNG)
## 페이징 주소 체계
- <페이지 번호, 변위> 와 같은 형태로 구성
  - 페이지 번호: 몇 번째 페이지 번호에 접근할 지를 나타냄
  - 변위: 접근하는 주소가 시작점으로부터 얼마나 떨어져 있는지를 나타냄
  - ![](https://velog.velcdn.com/images/passion_man/post/fd9bf063-7af2-418e-acc2-0c5d8af8e6c9/image.png)
  
# 페이지 교체 알고리즘
## 요구페이징
- 메모리에 필요한 페이지만을 적재하는 기법
  1. CPU가 특정 페이지에 접근하는 명령어를 실행한다
  2. 해당 페이지가 현재 메모리에 있을 경우, CPU는 페이지가 적재된 프레임에 접근한다.
  3. 해당 페이지가 현재 메모리에 없을 경우, 페이지 폴트가 발생한다.
  4. 페이지 폴트가 발생하면, 페이지 폴트 처리 루틴을 통해 해당 페이지를 메모리로 적재하고, 유효비트를 설정한다.
  5. 다시 1. 의 과정을 수행한다.
- 순수 요구 페이징: 아무 페이지도 적재하지 않은 채, 무작정 프로세스를 실행하는 경우

## 페이지 교체 알고리즘
- FIFO 페이지 교체 알고리즘: 메모리에 가장 먼저 올라온 페이지부터 내쫓는, 적재된 페이지 순서대로 교체하는 페이지 교체 알고리즘
- 최적 페이지 교체 알고리즘: 앞으로의 사용 빈도가 가장 낮은 페이지를 교체하는 페이지 교체 알고리즘
- LRU 페이지 교체 알고리즘: 가장 오랫동안 사용되지 않은 페이지를 교체하는 페이지 교체 알고리즘

## 기타 용어
- 스레싱: 프로세스가 실행되는 시간보다, 페이징에 더 많은 시간을 소요하여 성능이 저하되는 문제
- 메이저 페이지 폴트
  - 페이지를 읽어 들이기 위해 입출력 작업이 필요한 페이지 폴트
  - CPU가 접근하려는 페이지 가 물리 메모리에 없을 때 발생
- 마이너 페이지 폴트
  - 보조기억장치와의 입출력이 필요하지 않은 페이지 폴트
  - CPU가 요청한 페이지가 물리 메모리에는 존재하지만, 페이지 테이블 상에는 반영되지 않은 경우 발생

# 참고자료
- https://csnote.net/
- https://blog.naver.com/dilector/221787105234
- https://server-technology.tistory.com/450
- https://velog.io/@holicme7/OS%EB%A9%94%EB%AA%A8%EB%A6%AC%EA%B4%80%EB%A6%AC5-%EB%8B%A4%EB%8B%A8%EA%B3%84-%ED%8E%98%EC%9D%B4%EC%A7%80-%ED%85%8C%EC%9D%B4%EB%B8%94
- https://velog.io/@passion_man/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-9.-%ED%8E%98%EC%9D%B4%EC%A7%95-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC