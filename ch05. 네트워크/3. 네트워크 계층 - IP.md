# 네트워크 계층 - IP

## IP의 목적과 특징
- '신뢰할 수 없는 통신', '비연결형 통신' 특징

### 주소 지정과 단편화
- 주소 지정
  - 네트워크 간 통신 과정에서 호스트를 특정하는 것
  - IP 주소를 통해 이루어짐
    - IP 패킷 헤더 구조
      - 송신자 IP 주소
      - 수신자 IP 주소
    ![](https://csnote.net/assets/img/net/ipv4.png)
    - 옥텟: IP주소에서 점으로 구분된 하나의 10진수
    - 라우터를 이용하여, 패킷을 최적의 경로로 목적지까지 전달하는 기기
    ![](https://csnote.net/assets/img/net/routing.png)
- 단편화
  - 데이터를 여러 IP 패킷으로 올바르게 쪼개어 보내는 것
  - MTU: 최대 전송 단위 (약 1500바이트)
  - IP 패킷 헤더 구조
    - 식별자: 특정 패킷이 어떤 데이터에서 쪼개진 패킷인지를 식별하기 위해 사용되는 필드
    - 플래그: 단편화와 관련된 제어 정보를 담고 있는 필드
    - 단편화 오프셋: 단편화된 패킷이 원래 데이터에서 어느 위치에 속하는지를 나타내는 필드
  ![](https://csnote.net/assets/img/net/ipv4.png)
### 신뢰할 수 없는 통신과 비연결형 통신
- 신뢰할 수 없는 프로토콜: 패킷이 수신지까지 제대로 통신되었다고 보장하지 않는 프로토콜
- 비연결형 프로토콜: 송신자와 수신지 간에 사전 연결을 설정하지 않고 데이터를 전송하는 프로토콜

## IP 주소의 구조
- 네트워크 주소: 호스트가 속한 네트워크를 식별하는 부분
- 호스트 주소: 네트워크 내에서 특정 호스트를 식별하는 부분

### 클래스풀 주소 체계
- 클래스를 기반으로 IP 주소를 관리하는 주소 체계
![](https://csnote.net/assets/img/net/classful.png)
- 클래스 별 IP 주소 범위
  - 클래스 A: 0.0.0.0 ~ 127.255.255.255
  - 클래스 B: 128.0.0.0 ~ 191.255.255.255
  - 클래스 C: 192.0.0.0 ~ 223.255.255.255
- 예약 주소
  - 네트워크 주소: 호스트 주소가 모두 0인 주소
  - 브로드캐스트 주소: 호스트 주소가 모두 1인 주소
  - 루프백 주소: 자기 자신을 가리키는 주소 (127.0.0.1 or localhost)
  - 예약 IP 주소
    | IP 주소 범위               |      사용 목적          |
    |------------------|------------------------|
    | 0.0.0.0 ~ 0.255.255.255       | 이 네트워크 내의 호스트를 가리킬 때 사용 |
    | 127.0.0.0 ~ 127.255.255.255 | 자기 자신을 가리킬 때 사용         |
    | 10.0.0.0 ~ 10.255.255.255 | 사설 네트워크에서 사용        |
    | 172.16.0.0 ~ 172.31.255.255 | 사설 네트워크에서 사용        |
    | 192.168.0.0 ~ 168.168.255.255 | 사설 네트워크에서 사용        |
  
### 클래스리스 주소 체계와 서브넷 마스크
- 클래스리스 주소 체계: 서브넷 마스크를 활용하여 IP 주소를 관리하는 주소 체계
- 서브넷 마스크: IP 주소에서 네트워크 주소와 호스트 주소를 구분하는 데 사용되는 32비트 길이의 값
- CIDR 표기법: IP 주소 뒤에 슬래시(/)와 숫자를 붙여 서브넷 마스크 길이를 나타내는 표기법
  - 예: 192.168.1.1/24
  - 서브넷 마스크: 255.255.255.0
  - CIDR: 주소 블럭을 통해 호스트와 네트워크 수를 나눠 IP 주소를 효율적으로 관리할 수 있음
  - VLSM: 가변 길이 서브넷 마스크, 네트워크의 필요에 따라 서브넷 마스크 길이를 다르게 설정하는 방법
  ![](https://blog.skby.net/wp-content/uploads/2023/04/CIDR_Subnetting.png)

## 공인 IP 주소와 사설 IP 주소
- 공인IP 주소: 인터넷 상에서 고유하게 할당되는 IP 주소
- 사설IP 주소: 사설 네트워크 내에서만 사용되는 IP 주소
- NAT: 사설 네트워크 내의 사설 IP 주소를 공인 IP 주소로 변환하여 인터넷과 통신할 수 있도록 해주는 기술

## IP 주소의 할당

### 정적 할당
- 호스트에 직접 IP 주소를 부여하는 방식
- 기본 게이트웨이: 사설 네트워크에서 외부 네트워크로 나가는 출입구 역할을 하는 라우터의 IP 주소

### 동적 할당: DHCP
- DHCP: 호스트가 네트워크에 접속할 때마다 자동으로 IP 주소를 할당해주는 프로토콜
- DHCP 동작 과정
  - DHCP Discover: 호스트가 네트워크에 접속할 때 브로드캐스트 방식으로 DHCP 서버를 찾는 메시지 전송
  - DHCP Offer: DHCP 서버가 호스트에게 IP 주소와 기타 네트워크 설정 정보를 제안하는 메시지 전송
  - DHCP Request: 호스트가 제안된 IP 주소를 요청하는 메시지 전송
  - DHCP Acknowledgment: DHCP 서버가 호스트에게 IP 주소 할당을 확인하는 메시지 전송
  ![](https://changhoi.kim/images/2021-09-23-about-dhcp/03.png)

## IP 전송 특징의 보완: ICMP
- ICMP: IP 프로토콜의 전송 특징을 보완하기 위한 제어 메시지 프로토콜
- 주요 메시지 유형
  - 전송 과정에서 발생한 오류 보고
  - 네트워크에 대한 진단 정보 제공
- 홉: 호스트 또는 라우터를 한 번 거치는 과정을 의미
- TTL: 패킷이 네트워크를 통해 전달될 때 거칠 수 있는 최대 홉 수를 지정하는 필드
- 보안에서 사용되는 경우: Reconnaissance (정찰) 활동에 활용됨

## IP 주소와 MAC 주소의 대응: ARP
- ARP: IP 주소를 MAC 주소로 변환하는 프로토콜
- ARP 동작 과정
  - ARP 요청: 호스트가 특정 IP 주소에 해당하는 MAC 주소를 찾기 위해 브로드캐스트 방식으로 전송하는 메시지
  - ARP 응답: 해당 IP 주소를 가진 호스트가 자신의 MAC 주소를 포함하여 응답하는 메시지
  - ARP 캐시: IP 주소와 MAC 주소의 대응 정보를 저장하는 테이블
- 보안에서 사용되는 경우: ARP 스푸핑 공격(ARP를 조작하여, 다른 호스트에 연결하도록 함)에 활용됨


# 참고자료
- https://csnote.net/
- https://blog.skby.net/cidr-classless-inter-domain-routing/
- https://changhoi.kim/posts/network/about-dhcp/