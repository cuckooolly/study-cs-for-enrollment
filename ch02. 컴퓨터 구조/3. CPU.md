# 레지스터
- 레지스터
  - CPU 내부에 있는 작은 임시 저장 장치
  - 레지스터는 각각의 이름과 역할이 정해져 있음
  - 프로그램에서 실행되는 데이터가 레지스터에 저장됨
  - 비유: 수학을 풀이할 때 쓰는 "풀이 종이"와 같은 역할

- 레지스터의 종류
  - 프로그램 카운터 (Program Counter, PC)
    - 메모리에서 다음으로 읽어 들일 명령어의 주소를 저장
    - 명령어가 실행될 때마다, 다음 메모리 주소로 자동으로 증가
    - 명령어 포인터(Instruction Pointer, IP)라고도 불림
    - 비유: 다음에 계산할 수식을 가리킴
  - 명령어 레지스터 (Instruction Register, IR)
    - 메모리에서 방금 읽어 들인 명령어를 저장
    - CPU내 제어 장치는 명령어 레지스터 속 명령어를 해석한 뒤, ALU로 하여금 연산하도록 시키거나 다른 부품으로 제어신호를 보내 해당 부품을 작동시킴
      - CPU가 명령어를 해석하고 실행하는 데 사용됨
    - 비유: 현재 계산 중인 수식
  - 범용 레지스터 (General Purpose Register, GPR)
    - 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
    - 데이터와 명령어, 주소를 모두 저장할 수 있음
    - 비유: 수학 문제를 풀 때 사용하는 변수들
  - 플래그 레지스터 (Flag Register)
    - CPU가 명령어를 처리하는 과정에서 참고해야 할, 정보를 저장하는 레지스터
    - 비유: 수학 문제 풀이의 상태 표시 (예: "계산 완료", "오류 발생", "올림/내림 표시" 등)
    - 플래그 레지스터의 종류
    
    | 플래그 이름       | 설명                                |
    |--------------|-----------------------------------|
    | 부호 플래그       | 연산 결과의 부호                         |
    | 제로 플래그       | 연산 결과가 0인지 여부                     |
    | 캐리 플래그       | 연산 결과에 올림수나 빌림수가 발생했는지 여부         |
    | 오버플로우 플래그    | 오버플로우가 발생했는지의 여부                  |
    | 인터셉트 플래그     | 인터럽트가 가능한지의 여부                    |
    | 슈퍼바이저 플래그    | 커널모드로 실행 중인지, 사용자 모드로 실행 중인지의 여부  |
  
  - 스택 포인터 (Stack Pointer, SP)
    - 메모리 내 스택 영역의 최상단 스택 데이터 위치를 가리키는 레지스터
    - 비유: 수학 문제를 풀 때 사용하는 변수, 수학 문제가 위치한 주소, 중에서 현재 사용 중인 공간을 가리킴
# 인터럽트
- 인터럽트
  - CPU의 작업을 방해하는 신호
  - 인터럽트의 종류
    - 동기 인터럽트(예외): CPU에 의해 발생하는 인터럽트
    - 비동기 인터럽트(하드웨어 인터럽트)
      - 입출력장치에 의해 발생하는 인터럽트
      - 알림의 역할을 수행
      
- 하드웨어 인터럽트
  - 하드웨어 인터럽트를 이용해, CPU는 입출력장치의 작업을 기다리지 않고, 비동기적으로 실행할 수 있도록 함
  - CPU가 하드웨어 인터럽트를 처리하는 순서
    - 입출력장치는 CPU에게 인터럽트 요청 신호를 보냄
    - CPU는 실행 사이클이 끝나고, 명령어를 인출하기 전에 항상 인터럽트 여부를 확인함
    - CPU는 인터럽트 요청을 확인하고, 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인
    - 인터럽트를 받아들일 수 있다면, CPU가 지금까지의 작업을 백업
    - CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행
    - 인터럽트 서비스 루틴 실해이 끝나면, 백업해둔 작업을 복구하여 실행을 재개
  - 용어정리
    - 인터럽트 요청 신호: CPU에게 인터럽트 가능 여부를 확인하는 것
    - 인터럽트 플래그: 인터럽트를 받을 수 있는지 여부를 표시하는 플래그
    - 인터럽트 벡터: 인터럽트를 구분하기 위한 정보로, 인터럽트 핸들러의 시작 주소를 저장
    - 인터럽트 서비스 루틴(인터럽트 핸들러): 인터럽트를 어떻게 처리할 지에 대한 정보
    - ![](https://csnote.net/assets/img/arch/interrupt.png)
  
- 예외
  - 폴트(Fault): 예외 처리 직후, 예외가 발생한 명령어부터 실행을 재개하는 예외
    - 예시) 페이지 폴트: 프로그램이 원하는 데이터가 메모리에 없어 발생하는 예외
  - 트랩(Trap): 예외 처리 직후, 예외가 발생한 명령어 다음 명령어부터 실행을 재개하는 예외
  - 중단(Abort): 프로그램을 강제로 중단 시키는 예외
  - 소프트웨어 인터럽트: 시스템 콜을 통해 발생하는 예외

# CPU 성능 향상을 위한 설계
- CPU 클럭 속도
  - 클럭: 논리회로에 가해지는 전기적 진동의 속도를 나타내는 단위 (by 나무위키)
  - 클럭의 속도에 따라, 데이터의 연산이나 이동이 빨라져, CPU의 성능을 결정짓는 요소가 됨
- 멀티코어와 멀티스레드
  - 코어: CPU 내부에 존재하는 하드웨어 중에 ALU, 레지스터 등을 묶어 모듈화한 것 (by 나무위키)
  - 스레드: 프로세스보다는 작은 실행 단위 (by 나무위키)
    - 하드웨어 스레드: 하나의 코어가 동시에 처리하는 명령어의 단위
    - 소프트웨어 스레드: 하나의 프로그램에서 독립적으로 실행되는 단위
    - 하드웨어와 소프트웨어 스레드의 의미는 구분해서 이해해야 한다!
  - 병렬성: 작업을 동시에 처리하는 것
  - ![](https://csnote.net/assets/img/arch/parallelism.png)
  - 동시성: 작업을 나누어, 동시에 처리하는 것처럼 보이는 것
  - ![](https://csnote.net/assets/img/arch/concurrency.png)

# 파이프라이닝을 통한 명령어 병렬 처리
- 명령어 병렬 처리 기법: CPU를 쉬지 않고 작동시키기 위해 명령어를 동시에 처리하는 기술
  - CPU는 명령어의 인출, 해석, 실행, 결과 저장이 겹치지 않으면, 동시에 처리할 수 있기 때문
  - ![](https://csnote.net/assets/img/arch/pipeline.png)
  - 슈퍼스칼라: CPU 내부에 여러 명령어 파이프라인을 포함하는 구조

- 파이프라인의 성능을 차이를 보이는 명령어 집합 유형
  - CISC
    - 복잡한 기능을 지원하는 명령어 집합
    - 크기나 실행시간이 규격화되어 있지 않아, 파이프라이닝에 비효율적일 수 있음
  - RISC
    - 간단한 기능을 지원하는 명령어 집합
    - 크기나 실행시간이 규격화되어 있어, 파이프라이닝에 효율적임
  - 파이프라인 위험: 파이프라닝이 실패하여, 성능 향상이 이루어지지 않는 상황 
    - 데이터 위험
      - 명령어 간의 데이터 의존성에 의해 발생
      - 어떤 데이터가 다 처리 되어야, 다음 명령어를 실행할 수 있음
    - 제어 위험
      - 프로그램 카운터의 갑작스러운 변화에 의해 발생
      - 프로그램의 실행 흐름이 바뀌어, 프로그램 카운터 값에 갑작스러운 변화가 생기면 인출하거나 해석 중인 명령어들은 쓸모 없어지게 됨
    - 구조적 위험
      - 명령어를 겹쳐 실행하는 과정에서 서로 다른 명령어가 동시에 CPU 자원을 사용하려고 할 때 발생